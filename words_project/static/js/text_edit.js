// Generated by CoffeeScript 1.6.1
var addManualReference, addReference, getSelectedWord, getSelectionEnd, getSelectionLength, getSelectionStart, showPosition;

getSelectionStart = function() {
  return $('#text')[0].selectionStart;
};

getSelectionLength = function() {
  return getSelectedWord().length;
};

showPosition = function() {
  var position_length;
  position_length = getSelectionStart() + ', ' + getSelectionLength();
  return $('#status').html(position_length + ' ' + '<a href="javascript:addManualReference(' + position_length + ')">Add reference</a>');
};

getSelectionEnd = function() {
  return $('#text')[0].selectionEnd;
};

getSelectedWord = function() {
  return $('#text').val().substring(getSelectionStart(), getSelectionEnd()).trim();
};

$(function() {
  $('#text').click(function() {
    var word;
    $('#sidepanel').empty();
    showPosition();
    word = getSelectedWord();
    return get_translations(word, true);
  });
  return $('#text').keyup(function() {
    return showPosition();
  });
});

addManualReference = function(position, length) {
  var word_id;
  word_id = $('#word_id').val();
  if (word_id) {
    return addReference(word_id, position, length);
  }
};

addReference = function(word_id, position, length) {
  if (length == null) {
    length = getSelectionLength();
  }
  return $.post('/add_reference/', {
    text_id: text_id,
    word_id: word_id,
    position: position,
    length: length
  }, function(data) {
    return $('#word_id').val('');
  }).error(function() {
    return displayError('Ошибка добавления ссылки.');
  });
};
